-- FUNCIONARIOS QUE TRABALHAM NO PRODUTO X
SELECT F.Pnome, F.Unome
FROM FUNCIONARIO AS F
INNER JOIN TRABALHA_EM AS TE 
ON F.Cpf = TE.Fcpf
INNER JOIN PROJETO AS P
ON TE.Pnr = P.Projnumero
WHERE P.Projnome = 'ProdutoX';


SELECT P.Projnumero, D.Dnumero, F.Unome, F.Endereco, F.Datanasc
FROM PROJETO AS P
INNER JOIN DEPARTAMENTO AS D
ON D.Dnumero = P.Dnum
INNER JOIN LOCALIZACAO_DEP AS L
ON D.Dnumero = L.Dnumero
INNER JOIN FUNCIONARIO AS F
ON F.Cpf = D.Cpf_gerente
WHERE P.Projlocal = 'MauÃ¡';

SELECT F.Pnome AS 'F_Pnome', F.Unome AS 'F_Unome',
	   S.Pnome AS 'SUPERVISOR'
FROM FUNCIONARIO AS F
LEFT JOIN FUNCIONARIO AS S
ON F.Cpf_supervisor = S.Cpf;

SELECT D.Dnome
FROM DEPARTAMENTO AS D
LEFT JOIN FUNCIONARIO AS F
ON D.Dnumero = F.Dnr
WHERE F.Cpf IS NULL;

SELECT F.Pnome
FROM FUNCIONARIO AS F
WHERE F.Dnr IS NULL;

-- FULL JOIN
SELECT F.Pnome, F.Dnr, D.Dnome, D.Dnumero
FROM FUNCIONARIO AS F
FULL JOIN DEPARTAMENTO AS D
ON F.Dnr = D.Dnumero;

-- UNION
SELECT F.Pnome, F.Sexo, F.Datanasc
FROM FUNCIONARIO AS F
UNION
SELECT D.Nome_dependente, D.Sexo, D.Datanasc
FROM DEPENDENTE AS D;

SELECT L.Dlocal
FROM LOCALIZACAO_DEP AS L
UNION 
SELECT P.Projlocal
FROM PROJETO AS P;

-- EXCEPT
SELECT F.Cpf
FROM FUNCIONARIO AS F
EXCEPT
SELECT D.Cpf_gerente
FROM DEPARTAMENTO AS D;

SELECT F.Pnome, F.Unome
FROM FUNCIONARIO AS F
EXCEPT
SELECT S.Pnome, S.Unome
FROM FUNCIONARIO AS F
INNER JOIN FUNCIONARIO AS S
ON F.Cpf_supervisor = S.Cpf;

SELECT F.Pnome, F.Unome
FROM FUNCIONARIO AS F
WHERE F.Cpf IN (
				SELECT F.Cpf
				FROM FUNCIONARIO AS F
				EXCEPT
				SELECT S.Cpf
				FROM FUNCIONARIO AS F
				INNER JOIN FUNCIONARIO AS S
				ON F.Cpf_supervisor = S.Cpf
);

-- GROUP BY
SELECT D.Dnome AS 'N_DEPARTAMENTO', COUNT(F.Cpf) AS 'NUMERO_F'
FROM DEPARTAMENTO AS D
INNER JOIN FUNCIONARIO AS F
ON F.Dnr = D.Dnumero
GROUP BY  D.Dnome;

SELECT D.Dnome, SUM(F.Salario)
FROM DEPARTAMENTO AS D
INNER JOIN FUNCIONARIO AS F 
ON F.Dnr = D.Dnumero
GROUP BY D.Dnome;

SELECT P.Projnome, AVG(TE.Horas)
FROM PROJETO AS P
INNER JOIN TRABALHA_EM AS TE
ON P.Projnumero = TE.Pnr
GROUP BY P.Projnome;

SELECT COUNT(*) AS 'NUMERO' , F.Sexo AS 'SEXO'
FROM FUNCIONARIO AS F
GROUP BY F.Sexo;

SELECT D.Dnome, MAX(F.Salario)
FROM DEPARTAMENTO AS D
INNER JOIN FUNCIONARIO AS F
ON F.Dnr = D.Dnumero
GROUP BY D.Dnome;

-- HAVING

SELECT D.Dnome AS 'DEPARTAMENTO', COUNT(F.Cpf) AS 'PESSOAS'
FROM FUNCIONARIO AS F
INNER JOIN DEPARTAMENTO AS D
ON F.Dnr = D.Dnumero
GROUP BY D.Dnome
HAVING COUNT(F.Cpf) > 3;

SELECT P.Projnome AS 'PROJETO', SUM(TE.Horas) AS 'HORAS'
FROM PROJETO AS P
INNER JOIN TRABALHA_EM AS TE
ON TE.Pnr = P.Projnumero
GROUP BY P.Projnome 
HAVING SUM(TE.Horas) >= 50;

SELECT F.Pnome AS 'NOME'
FROM FUNCIONARIO AS F
WHERE EXISTS (SELECT 1
			  FROM DEPARTAMENTO AS D
			  WHERE D.Cpf_gerente = F.Cpf
			  );

 
